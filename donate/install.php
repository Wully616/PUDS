<?phpob_start();/////////////////////////////////////////////////PUDS Config Installer//////////////////Configuration////////////////////////Steam API Key//////////////////////////$_STEAMAPI = "";/////////////////////////////////////////require("config.php");require("openid.php");require("admin.php");function GetSteamNorm($Steam64){		$authserver = bcsub( $Steam64, '76561197960265728' ) & 1;	//Get the third number of the steamid	$authid = ( bcsub( $Steam64, '76561197960265728' ) - $authserver ) / 2;	//Concatenate the STEAM_ prefix and the first number, which is always 0, as well as colons with the other two numbers	$steamid = "STEAM_0:$authserver:$authid";	return $steamid;}// this is a work in progress and is not completed yet, it is not recommended to use this//Gets the current URLfunction curDomain() {	$pageURL = 'http';	if ($_SERVER["HTTPS"] == "on") {		$pageURL .= "s";	}		$pageURL .= "://";	if ($_SERVER["SERVER_PORT"] != "80") {		$pageURL .= $_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"];	} else {		$pageURL .= $_SERVER["SERVER_NAME"];	}	return $pageURL;}//Gets the current Directoryfunction curDirectory() {	$current_dir_url = 'http';	if ($_SERVER["HTTPS"] == "on") {		$pageURL .= "s";	}		$current_dir_url .= "://";	if ($_SERVER["SERVER_PORT"] != "80") {		$current_dir_url .= $_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"];	} else {		$current_dir_url .= $_SERVER["SERVER_NAME"];	}	$current_dir_url .= dirname($_SERVER['PHP_SELF']);	return $current_dir_url;}	//Defaultsif (empty($UseDB)) {	$UseDB = 'true';}if (empty($HOST)) {	$HOST = 'localhost';}if (empty($payPalURL)) {	$payPalURL = 'https://www.paypal.com/cgi-bin/webscr';}if (empty($website)) {	$website = curDomain();}if (empty($currency)) {	$currency = 'GBP';}if (empty($IPN)) {	$IPN = curDirectory() .'/ipn.php';}if (empty($donateDir)) {	$donateDir = curDirectory();}if (empty($messageRankFail)){	$messageRankFail ='	Thank you for your purchase $name Your rank information 	------------------------- 	Paid: \$fee 	SteamID: \$steamid 	Rank: \$rank 	-------------------------	There has been an issue when adding your SteamID to the correct usergroup.	Please contact the server admin to resolve this issue.';}if (empty($messageSuccess)){	$messageSuccess ='Thank you for your purchase $name Your rank information	------------------------- 	Paid: \$fee 	SteamID: \$steamid	Rank: \$rank	-------------------------	Your rank will be available immediately';}if (empty($messageIPNFail)){	$messageIPNFail ='	Hello, The donation has failed to be verified by PayPal IPN, however payment may have been taken.	Please contact the owner of the server to resolve this issue.';}if (ISSET($_POST["Submit"])) {	$steam64 = $_POST[steam64];	echo '<p> Config successfully updated!</p>';	$string = "<?php \$name = '';\n	\$fee = '';\n	\$steamid = '';\n	\$rank = '';\n	\$donationDir = '$_POST[donationDir]';\n	\$IP = '$_POST[IP]';\n	\$PORT = '$_POST[PORT]';\n	\$PASSWORD = '$_POST[PASSWORD]';\n	\$UseDB = '$_POST[UseDB]';\n	\$HOST = '$_POST[HOST]';\n	\$DBUSER = '$_POST[DBUSER]';\n	\$DBPASS = '$_POST[DBPASS]';\n	\$DBNAME = '$_POST[DBNAME]';\n	\$DBTABLE = '$_POST[DBTABLE]';\n	\$payPalURL = '$_POST[payPalURL]';\n	\$IPN = '$_POST[IPN]';\n	\$payPalEmail = '$_POST[payPalEmail]';\n	\$website = '$_POST[website]';\n	\$currency = '$_POST[currency]';\n	\$prices = array('$_POST[prices]');\n	\$ranks = array('$_POST[ranks]');\n	\$commands = array('$_POST[ranks]');\n	\$messageRankFail = '$_POST[messageRankFail]';\n	\$messageSuccess = '$_POST[messageSuccess]';\n	\$messageIPNFail = '$_POST[messageIPNFail]';\n	?>";	 $fp = FOPEN("config.php", "w");	FWRITE($fp, $string);	FCLOSE($fp);};if(empty($_STEAMAPI)) {	echo "<h1>You have not configured PUDS installer correctly! Please edit install.php and put your Steam API Key in the top of the file and try again!</h1>";}	echo "<h1>PayPal-ULX Donation System Config Installer</h1>			<p>Please login to configure Wullys PayPal-ULX Donation System</p>			<form action='?login' method='post'>			<input type='image' src='http://cdn.steamcommunity.com/public/images/signinthroughsteam/sits_small.png'>		</form>";	try {		$openid = new LightOpenID('http://wullysgamers.co.uk/donate/');		if(!$openid->mode){			if(isset($_GET['login'])) {				$openid->identity = 'http://steamcommunity.com/openid/?l=english';				// This is forcing english because it has a weird habit of selecting a random language otherwise				header('Location: ' . $openid->authUrl());			}		} elseif($openid->mode == 'cancel') {			echo 'User has canceled authentication!';		} else { 			if($openid->validate()) {				$id = $openid->identity;				// identity is something like: http://steamcommunity.com/openid/id/76561197960435530				// we only care about the unique account ID at the end of the URL.				$ptn = "/^http:\/\/steamcommunity\.com\/openid\/id\/(7[0-9]{15,25}+)$/";				preg_match($ptn, $id, $matches);				echo "User is logged in (steamID: $matches[1])\n";				$url = "http://api.steampowered.com/ISteamUser/GetPlayerSummaries/v0002/?key=$_STEAMAPI&steamids=$matches[1]";				$json_object= file_get_contents($url);				$json_decoded = json_decode($json_object);				foreach ($json_decoded->response->players as $player){					/*echo "											<br/>Player ID: $player->steamid					<br/>Player Name: $player->personaname					<br/>Profile URL: $player->profileurl					<br/>SmallAvatar: <img src='$player->avatar'/>					<br/>MediumAvatar: <img src='$player->avatarmedium'/>					<br/>LargeAvatar: <img src='$player->avatarfull'/>";					*/											$steam64 = $player->steamid;					$steamID = GetSteamNorm($steam64);					echo "<br/>SmallAvatar: <img src='$player->avatar'/>";					//Get normal steamID					#$steam = new SteamAPI($steam64);					#$friendlyName = $steam->getFriendlyName();					//Get players ingame name					$friendlyName = $player->personaname;					//Get players ingame name				}					if(empty($admin)){					$steam64 = "<?php \$admin = '$steam64';?>";					$fp = FOPEN("admin.php", "w");					FWRITE($fp, $steam64);					FCLOSE($fp);					echo "<p> Successfully grabbed your details!</p>";								}			}				}	}	catch(ErrorException $e) {		echo $e->getMessage();	}if($admin = $steam64){echo "<h1>PayPay-ULX Donation System Config Installer</h1>	<p> Hello $friendlyName</p>	<form action='' method='post' name='install' id='install'>	<h2>Garrysmod Server Configuration</h2>	<p><input name='IP' type='text' id='IP' value=$IP>Server IP</p>	<p><input name='PORT' type='text' id='PORT' value=$PORT>Server Port</p>		<p><input name='PASSWORD' type='password' id='PASSWORD' value=$PASSWORD>RCON Password</p>	<h2>Donation directory</h2>	<p><input name='donationDir' type='text' id='donationDir' value=$donateDir>Donation Files Directory</p>	<h2>MySQL Database Configuration</h2>	<p><select name='UseDB' type='text' id='UseDB'>";		$truefalse ="<option value='true'>True</option>				<option value='false'>False</option>";	$truefalse = str_replace("'$UseDB'", "'$UseDB' selected", $truefalse);	echo $truefalse;	echo"</select>	Use MySQL (true/false) 	</p>	<p><input name='HOST' type='text' id='HOST' value=$HOST>Database Host</p>	<p><input name='DBUSER' type='text' id='DBUSER' value=$DBUSER>Database User</p>	<p><input name='DBPASS' type='password' id='DBPASS' value=$DBPASS>Database Password</p>	<p><input name='DBNAME' type='text' id='DBNAME' value=$DBNAME>Database Name</p>	<p><input name='DBTABLE' type='text' id='DBTABLE' value=$DBTABLE>Database Table</p>	<p>	<h2>PayPal Configuration</h2> 	<select name='payPalURL' type='text' id='payPalURL'>";	$paypalurls ="<option value=https://www.paypal.com/cgi-bin/webscr>Live PayPalURL</option>	<option value=https://www.paypal.com/cgi-bin/webscr>Sandbox PayPalURL</option>";	$paypalurls = str_replace("'$payPalURL'", "'$payPalURL' selected", $paypalurls);	echo $paypalurls;	echo "</select>	PayPal URL 	</p>	<p><input name='IPN' type='text' id='IPN' value=$IPN>IPN Script URL</p>	<p><input name='website' type='text' id='website' value=$website>Your website</p>	<p><select name='currency' type='text' id='currency'>";	$currencycodes ="<option value='AUD'>AUD Australian Dollar</option>	<option value='CAD'>CAD Canadian Dollar</option>	<option value='CZK'>CZK Czech Koruna</option>	<option value='DKK'>DKK Danish Krone</option>	<option value='EUR'>EUR Euro</option>	<option value='HKD'>HKD Hong Kong Dollar</option>	<option value='HUF'>HUF Hungarian Forint</option>	<option value='ILS'>ILS Israeli New Sheqel</option>		<option value='JPY'>JPY Japanese Yen</option>		<option value='MXN'>MXN Mexican Peso</option>		<option value='NOK'>NOK Norwegian Krone</option>		<option value='NZD'>NZD New Zealand Dollar</option>		<option value='PHP'>PHP Philippine Peso</option>		<option value='PLN'>PLN Polish Zloty</option>			<option value='GBP'>GBP Pound Sterling</option>			<option value='SGD'>SGD Singapore Dollar</option>	<option value='SEK'>SEK Swedish Krona</option>	<option value='CHF'>CHF Swiss Franc</option>	<option value='TWD'>TWD Taiwan New Dollar</option>	<option value='THB'>THB Thai Baht</option>	<option value='USD'>USD U.S. Dollar</option>";	$currencycodes = str_replace("'$currency'", "'$currency' selected", $currencycodes);	echo $currencycodes;	$str_prices = implode(",", $prices);	$str_ranks = implode(",", $ranks);	$str_commands = implode(",", $commands);	echo "</select>	Your currency</p>	<h2>Donation/Rank Configuration</h2> 	<p>Each item in the following lists align with each other, please keep them comma separated.</p>	<p><input name='prices' type='text' id='prices' value='$str_prices' style='width: 300px;'>Prices</p>	<p><input name='ranks' type='text' id='ranks' value='$str_ranks' style='width: 300px;'>Ranks</p>	<p><input name='commands' type='text' id='commands' value='$str_commands' style='width: 300px;'>Commands</p>	<h2>E-mail Messages Configuration</h2> 	<p><TEXTAREA name='messageRankFail' rows='10' cols='80'>$messageRankFail</TEXTAREA>Failed Rank E-mail</p>	<p><TEXTAREA name='messageSuccess' rows='10' cols='80'>$messageSuccess</TEXTAREA>Successful E-mail</p>	<p><TEXTAREA name='messageIPNFail' rows='10' cols='80'>$messageIPNFail</TEXTAREA>IPN Failed E-mail</p>	<p>Click Save to write to the config file. Click Load to load the config for editing.</p>	<input type='submit' name='Submit' value='Save'>	<input type='button' value='Load' onClick='window.location.reload()'>	<input type='hidden' name='Language' value='English'>	</p>	</form>";} else {	echo "<p>Hello, $friendlyName You are not admin or logged in! Please login as admin.";} ?>